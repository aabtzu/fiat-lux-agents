<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>fiat-lux-agents test app</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

<header>
  <h1>fiat-lux-agents — test app</h1>
  <p>Sample sales dataset · 15 records · Testing FilterBot, ChatBot, FilterChatBot, QueryEngine</p>
</header>

<nav class="tabs">
  <div class="tab active" data-tab="data">Data</div>
  <div class="tab" data-tab="filter">Filter</div>
  <div class="tab" data-tab="query">Query</div>
  <div class="tab" data-tab="filterchat">Filter Chat</div>
</nav>

<!-- DATA TAB -->
<div class="panel active" id="tab-data">
  <div class="table-toolbar">
    <div class="stats-bar" style="margin:0">
      <span id="stat-total">Total: —</span>
      <span id="stat-filtered">Showing: —</span>
      <span id="stat-filters">Filters: 0</span>
    </div>
    <button id="btn-show-filtered" class="btn-toggle-visibility" onclick="toggleShowFiltered()">Show filtered out</button>
  </div>
  <table id="data-table">
    <thead><tr>
      <th>Name</th><th>Region</th><th>Category</th><th>Status</th>
      <th>Amount</th><th>Units</th><th>Month</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</div>

<!-- FILTER TAB -->
<div class="panel" id="tab-filter">
  <div class="filter-layout">
    <div>
      <div class="table-toolbar">
        <div class="active-filters" id="filter-tags" style="margin:0;flex:1">
          <span class="empty">No active filters</span>
        </div>
        <button id="btn-show-filtered-filter" class="btn-toggle-visibility" onclick="toggleShowFiltered()">Show filtered out</button>
      </div>
      <table id="filter-table">
        <thead><tr>
          <th>Name</th><th>Region</th><th>Category</th><th>Status</th>
          <th>Amount</th><th>Units</th><th>Month</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <div>
      <div class="sidebar-card">
        <h3>Add filter (natural language)</h3>
        <div class="input-row">
          <input type="text" id="filter-input" placeholder='e.g. "only completed sales"'>
          <button onclick="addFilter()">Add</button>
        </div>
        <div id="filter-status" style="margin-top:8px;font-size:12px;color:#666;"></div>
        <div style="margin-top:12px;">
          <button class="btn-sm btn-danger" onclick="clearFilters()">Clear all filters</button>
        </div>
        <div style="margin-top:16px;">
          <h3>Try these:</h3>
          <div style="display:flex;flex-direction:column;gap:4px;margin-top:6px;">
            <button class="btn-sm" onclick="setFilter('only completed sales')">only completed sales</button>
            <button class="btn-sm" onclick="setFilter('amount greater than 500')">amount greater than 500</button>
            <button class="btn-sm" onclick="setFilter('only Electronics category')">only Electronics</button>
            <button class="btn-sm" onclick="setFilter('exclude West region')">exclude West region</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- QUERY TAB -->
<div class="panel" id="tab-query">
  <div class="chat-layout">
    <div>
      <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
        <div class="scope-toggle">
          <button class="query-scope-btn active" data-scope="filtered" onclick="setQueryScope('filtered')">Filtered</button>
          <button class="query-scope-btn" data-scope="all" onclick="setQueryScope('all')">All data</button>
        </div>
        <span class="scope-label" id="query-scope-label">(filtered rows)</span>
      </div>
      <div class="messages" id="query-messages">
        <div class="msg assistant">Ask a question about the data. I'll generate a pandas query and show the results.</div>
      </div>
      <div class="input-row">
        <input type="text" id="query-input" placeholder='e.g. "total amount by category"'>
        <button onclick="sendQuery()">Ask</button>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div class="sidebar-card">
        <h3>Last generated query</h3>
        <pre id="query-code" class="empty">None yet</pre>
      </div>
      <div class="sidebar-card">
        <h3>Result data</h3>
        <pre id="query-result" class="empty">None yet</pre>
      </div>
      <div class="sidebar-card">
        <button class="btn-sm btn-danger" onclick="clearQueryHistory()">Clear history</button>
      </div>
    </div>
  </div>
</div>

<!-- FILTER CHAT TAB -->
<div class="panel" id="tab-filterchat">
  <div class="chat-layout">
    <div>
      <div class="messages" id="filterchat-messages">
        <div class="msg assistant">Ask questions about the data or request filters — I'll handle both.</div>
      </div>
      <div class="input-row">
        <input type="text" id="filterchat-input" placeholder='e.g. "how many completed sales?" or "filter to just Electronics"'>
        <button onclick="sendFilterChat()">Send</button>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div class="sidebar-card">
        <h3>Active filters</h3>
        <div id="filterchat-tags" style="margin-bottom:8px"><span class="empty">None</span></div>
        <button class="btn-sm btn-danger" onclick="clearFiltersFromChat()">Clear all filters</button>
      </div>
      <div class="sidebar-card">
        <h3>Filtered data</h3>
        <pre id="filterchat-result" class="empty">None yet</pre>
      </div>
      <div class="sidebar-card">
        <button class="btn-sm btn-danger" onclick="clearFilterChat()">Clear chat</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
<script src="/static/js/app.js"></script>
</body>
</html>
